// main program for node based word guessing game
import * as _ from "lodash";
import Word from "./word";
import { terminal as term } from "terminal-kit";
// global variables and constants
const wordsArr = [
    "javascript",
    "html",
    "mongo",
    "chrome",
    "node",
    "css"
];
// object to hold x,y locations of inputs and outputs for use by terminal-kit
const termXY = {
    chosenLetters: { x: 25, y: 10 },
    wordSoFar: { x: 25, y: 12 },
    getWord: { x: 25, y: 15 },
    input: { x: 25, y: 13 },
    chooseAgain: { x: 25, y: 18 }
};
// offsets the instructions from left hand side
const xOffset = 5;
// can't seem to turn off the event listener so using a global variable to make it doesn't return anything
var readWord = false;
// holds the word selected by random from wordsArr
var theWord;
// array to hold the letters chosen
var lettersChosen = [];
// randomly choose a word from wordsArr
function chooseWord() {
    let random = _.random(0, (wordsArr.length - 1));
    theWord = new Word(wordsArr[random]);
}
// clears the screen and then prints out all the information
function setupTerminal() {
    term.clear();
    // write information to screen
    term.moveTo(xOffset, termXY.input.y);
    term("Type letters");
    term.moveTo(xOffset, termXY.chosenLetters.y);
    term("Letters chosen ");
    term.moveTo(xOffset, termXY.wordSoFar.y);
    term("Word so far ");
    // move cursor to input position
    term.moveTo(termXY.input.x, termXY.input.y);
}
function showWord() {
    let word = theWord.word2string();
    term.moveTo(termXY.wordSoFar.x, termXY.wordSoFar.y);
    term(word);
    // want to know how many characters
    term("  (" + theWord.letterArr.length + " characters)");
    term.moveTo(termXY.input.x, termXY.input.y);
}
function showLettersChosen() {
    term.moveTo(termXY.chosenLetters.x, termXY.chosenLetters.y);
    term(lettersChosen.join(","));
    term.moveTo(termXY.input.x, termXY.input.y);
}
function exitGame(message) {
    // move down 10 lines
    term.nextLine(10);
    if (message !== undefined) {
        console.log(String(message));
    }
    // using this exit resets any strange stuff the terminal is doing
    term.processExit(0);
}
function guessWord() {
    term.moveTo(xOffset, termXY.getWord.y);
    term("Guess the word ");
    term.moveTo(xOffset, termXY.getWord.y + 1);
    term("(RETURN to finish)");
    term.moveTo(termXY.getWord.x, termXY.getWord.y);
    // turn off the key event listener using global variable
    readWord = true;
    term.inputField(function (error, input) {
        if (error) {
            // term.red.bold("\nAn error occurred reading input field: " + error + "\n");
            exitGame(term.red.str("\nAn error occurred reading input field: " + error + "\n"));
        }
        else {
            // console.log("\nInput was " + input);
            if (input === theWord.word2FullString()) {
                readWord = false;
                wordCompleted();
            }
            else {
                term.moveTo(xOffset, termXY.getWord.y);
                term("                                   ");
                term.moveTo(xOffset, termXY.getWord.y + 1);
                term("                    ");
                term.moveTo(termXY.getWord.x, termXY.getWord.y);
                term("Guess " + input + " was wrong                                  ");
                // move cursor back to input position
                term.moveTo(termXY.input.x, termXY.input.y);
            }
        }
        // let the event listener work again
        readWord = false;
    });
}
// function called when a key is pressed in raw mode
function processInput(char) {
    const regexp = new RegExp("[a-z]", "i");
    if (char === "ENTER") {
        // make a guess at the word
        guessWord();
    }
    else if ((char.length === 1) && (regexp.test(char))) {
        const lcChar = char.toLowerCase();
        // console.log("valid input " + char);
        // check to see whether letter has already been selected
        if (_.indexOf(lettersChosen, lcChar) > 0) {
            // don't process anything because letter has already been selected
        }
        else {
            theWord.checkChar(lcChar);
            lettersChosen.push(lcChar);
            // check to see if word is completed
            if (theWord.word2string().includes("_")) {
                // not completed
                showWord();
                showLettersChosen();
            }
            else {
                showWord();
                showLettersChosen();
                wordCompleted();
            }
        }
    }
    // any other key pressed does nothing  
}
function wordCompleted() {
    // erase guessed word
    term.moveTo(termXY.getWord.x, termXY.getWord.y);
    term("                                          ");
    term.moveTo(termXY.chooseAgain.x, termXY.chooseAgain.y);
    term("completed word " + theWord.word2FullString());
    term(" Another game ? (Y/n)");
    readWord = true; // not really reading word but disables key event
    term.yesOrNo({ yes: ['y', 'Y', 'ENTER'], no: ['n', 'N'] }, function (error, result) {
        if (result) {
            readWord = false; // re-enabled key event
            start();
        }
        else {
            exitGame();
        }
    });
}
function start() {
    chooseWord();
    lettersChosen = [];
    setupTerminal();
    showWord();
    showLettersChosen();
    // after setup, program is driven by key presses
}
// showWord();
// showLettersChosen();
// getInput();
start();
// console.log(theWord);
// set terminal up to read key presses
term.grabInput(true);
// set watcher on key input
term.on('key', function (name, matches, data) {
    if (name === 'CTRL_C') {
        exitGame("Control C pressed - exiting game");
    }
    else {
        // console.log("'key' event:" + name + " matches " + matches + " data " + data);
        if (!readWord) {
            processInput(name);
        }
    }
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,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a0MsQ0FBQyxDQUFDO0tBQ2hEO1NBQ0k7UUFDRCxnRkFBZ0Y7UUFFaEYsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNYLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUN0QjtLQUNKO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoid29yZEdhbWVOb2RlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gbWFpbiBwcm9ncmFtIGZvciBub2RlIGJhc2VkIHdvcmQgZ3Vlc3NpbmcgZ2FtZVxyXG5cclxuaW1wb3J0ICogYXMgXyBmcm9tIFwibG9kYXNoXCI7XHJcbmltcG9ydCBXb3JkIGZyb20gXCIuL3dvcmRcIjtcclxuaW1wb3J0IHt0ZXJtaW5hbCBhcyB0ZXJtfSBmcm9tIFwidGVybWluYWwta2l0XCI7XHJcblxyXG5cclxuLy8gZ2xvYmFsIHZhcmlhYmxlcyBhbmQgY29uc3RhbnRzXHJcbmNvbnN0IHdvcmRzQXJyID0gW1xyXG4gICAgXCJqYXZhc2NyaXB0XCIsXHJcbiAgICBcImh0bWxcIixcclxuICAgIFwibW9uZ29cIixcclxuICAgIFwiY2hyb21lXCIsXHJcbiAgICBcIm5vZGVcIixcclxuICAgIFwiY3NzXCJcclxuXTtcclxuXHJcbi8vIG9iamVjdCB0byBob2xkIHgseSBsb2NhdGlvbnMgb2YgaW5wdXRzIGFuZCBvdXRwdXRzIGZvciB1c2UgYnkgdGVybWluYWwta2l0XHJcbmNvbnN0IHRlcm1YWSA9IHtcclxuICAgIGNob3NlbkxldHRlcnM6IHsgeDoyNSwgeToxMH0sXHJcbiAgICB3b3JkU29GYXI6ICAgICB7IHg6MjUsIHk6MTJ9LFxyXG4gICAgZ2V0V29yZDogICAgICAgeyB4OjI1LCB5OjE1fSxcclxuICAgIGlucHV0OiAgICAgICAgIHsgeDoyNSwgeToxM30sXHJcbiAgICBjaG9vc2VBZ2FpbjogICB7IHg6MjUsIHk6MTh9XHJcbn07XHJcblxyXG4vLyBvZmZzZXRzIHRoZSBpbnN0cnVjdGlvbnMgZnJvbSBsZWZ0IGhhbmQgc2lkZVxyXG5jb25zdCB4T2Zmc2V0ID0gNTtcclxuLy8gY2FuJ3Qgc2VlbSB0byB0dXJuIG9mZiB0aGUgZXZlbnQgbGlzdGVuZXIgc28gdXNpbmcgYSBnbG9iYWwgdmFyaWFibGUgdG8gbWFrZSBpdCBkb2Vzbid0IHJldHVybiBhbnl0aGluZ1xyXG52YXIgcmVhZFdvcmQgPSBmYWxzZTtcclxuLy8gaG9sZHMgdGhlIHdvcmQgc2VsZWN0ZWQgYnkgcmFuZG9tIGZyb20gd29yZHNBcnJcclxudmFyIHRoZVdvcmQ6V29yZDtcclxuXHJcbi8vIGFycmF5IHRvIGhvbGQgdGhlIGxldHRlcnMgY2hvc2VuXHJcbnZhciBsZXR0ZXJzQ2hvc2VuOnN0cmluZ1tdID0gW107XHJcblxyXG4vLyByYW5kb21seSBjaG9vc2UgYSB3b3JkIGZyb20gd29yZHNBcnJcclxuZnVuY3Rpb24gY2hvb3NlV29yZCAoKSB7XHJcbiAgICBsZXQgcmFuZG9tID0gXy5yYW5kb20oMCwgKHdvcmRzQXJyLmxlbmd0aCAtMSApKTtcclxuICAgIHRoZVdvcmQgPSBuZXcgV29yZCh3b3Jkc0FycltyYW5kb21dKTtcclxuICAgIFxyXG59XHJcblxyXG4vLyBjbGVhcnMgdGhlIHNjcmVlbiBhbmQgdGhlbiBwcmludHMgb3V0IGFsbCB0aGUgaW5mb3JtYXRpb25cclxuZnVuY3Rpb24gc2V0dXBUZXJtaW5hbCgpOnZvaWQge1xyXG4gICAgdGVybS5jbGVhcigpO1xyXG4gICAgLy8gd3JpdGUgaW5mb3JtYXRpb24gdG8gc2NyZWVuXHJcbiAgICB0ZXJtLm1vdmVUbyh4T2Zmc2V0LHRlcm1YWS5pbnB1dC55KTtcclxuICAgIHRlcm0oXCJUeXBlIGxldHRlcnNcIik7XHJcbiAgICB0ZXJtLm1vdmVUbyh4T2Zmc2V0LCB0ZXJtWFkuY2hvc2VuTGV0dGVycy55KTtcclxuICAgIHRlcm0oXCJMZXR0ZXJzIGNob3NlbiBcIik7XHJcbiAgICB0ZXJtLm1vdmVUbyh4T2Zmc2V0LCB0ZXJtWFkud29yZFNvRmFyLnkpO1xyXG4gICAgdGVybShcIldvcmQgc28gZmFyIFwiKTtcclxuICAgIC8vIG1vdmUgY3Vyc29yIHRvIGlucHV0IHBvc2l0aW9uXHJcbiAgICB0ZXJtLm1vdmVUbyh0ZXJtWFkuaW5wdXQueCwgdGVybVhZLmlucHV0LnkpO1xyXG5cclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIHNob3dXb3JkKCk6dm9pZCB7XHJcbiAgICBsZXQgd29yZDpzdHJpbmcgPSB0aGVXb3JkLndvcmQyc3RyaW5nKCk7XHJcbiAgICB0ZXJtLm1vdmVUbyh0ZXJtWFkud29yZFNvRmFyLngsIHRlcm1YWS53b3JkU29GYXIueSk7XHJcbiAgICB0ZXJtKHdvcmQpO1xyXG4gICAgLy8gd2FudCB0byBrbm93IGhvdyBtYW55IGNoYXJhY3RlcnNcclxuICAgIHRlcm0oXCIgIChcIiArIHRoZVdvcmQubGV0dGVyQXJyLmxlbmd0aCArIFwiIGNoYXJhY3RlcnMpXCIpO1xyXG4gICAgdGVybS5tb3ZlVG8odGVybVhZLmlucHV0LngsIHRlcm1YWS5pbnB1dC55KTtcclxufVxyXG5cclxuZnVuY3Rpb24gc2hvd0xldHRlcnNDaG9zZW4gKCk6dm9pZCB7XHJcbiAgICB0ZXJtLm1vdmVUbyh0ZXJtWFkuY2hvc2VuTGV0dGVycy54LCB0ZXJtWFkuY2hvc2VuTGV0dGVycy55KTtcclxuICAgIHRlcm0oIGxldHRlcnNDaG9zZW4uam9pbihcIixcIikpO1xyXG4gICAgdGVybS5tb3ZlVG8odGVybVhZLmlucHV0LngsIHRlcm1YWS5pbnB1dC55KTtcclxufVxyXG5cclxuZnVuY3Rpb24gZXhpdEdhbWUobWVzc2FnZT86IGFueSk6IHZvaWQge1xyXG4gICAgLy8gbW92ZSBkb3duIDEwIGxpbmVzXHJcbiAgICB0ZXJtLm5leHRMaW5lKDEwKTtcclxuICAgIGlmIChtZXNzYWdlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhTdHJpbmcobWVzc2FnZSkpO1xyXG4gICAgfVxyXG4gICAgLy8gdXNpbmcgdGhpcyBleGl0IHJlc2V0cyBhbnkgc3RyYW5nZSBzdHVmZiB0aGUgdGVybWluYWwgaXMgZG9pbmdcclxuICAgIHRlcm0ucHJvY2Vzc0V4aXQoMCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGd1ZXNzV29yZCgpOnZvaWQge1xyXG4gICAgdGVybS5tb3ZlVG8oeE9mZnNldCwgdGVybVhZLmdldFdvcmQueSk7XHJcbiAgICB0ZXJtKFwiR3Vlc3MgdGhlIHdvcmQgXCIpO1xyXG4gICAgdGVybS5tb3ZlVG8oeE9mZnNldCwgdGVybVhZLmdldFdvcmQueSArIDEpO1xyXG4gICAgdGVybShcIihSRVRVUk4gdG8gZmluaXNoKVwiKTtcclxuICAgIHRlcm0ubW92ZVRvKHRlcm1YWS5nZXRXb3JkLngsIHRlcm1YWS5nZXRXb3JkLnkpO1xyXG4gICAgLy8gdHVybiBvZmYgdGhlIGtleSBldmVudCBsaXN0ZW5lciB1c2luZyBnbG9iYWwgdmFyaWFibGVcclxuICAgIHJlYWRXb3JkID0gdHJ1ZTtcclxuICAgIHRlcm0uaW5wdXRGaWVsZChmdW5jdGlvbiAoZXJyb3I6IGFueSwgaW5wdXQ6IHN0cmluZykge1xyXG4gICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICAvLyB0ZXJtLnJlZC5ib2xkKFwiXFxuQW4gZXJyb3Igb2NjdXJyZWQgcmVhZGluZyBpbnB1dCBmaWVsZDogXCIgKyBlcnJvciArIFwiXFxuXCIpO1xyXG4gICAgICAgICAgICBleGl0R2FtZSh0ZXJtLnJlZC5zdHIoXCJcXG5BbiBlcnJvciBvY2N1cnJlZCByZWFkaW5nIGlucHV0IGZpZWxkOiBcIiArIGVycm9yICsgXCJcXG5cIikpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJcXG5JbnB1dCB3YXMgXCIgKyBpbnB1dCk7XHJcbiAgICAgICAgICAgIGlmKCBpbnB1dCA9PT0gdGhlV29yZC53b3JkMkZ1bGxTdHJpbmcoKSkge1xyXG4gICAgICAgICAgICAgICAgcmVhZFdvcmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHdvcmRDb21wbGV0ZWQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRlcm0ubW92ZVRvKHhPZmZzZXQsIHRlcm1YWS5nZXRXb3JkLnkpO1xyXG4gICAgICAgICAgICAgICAgdGVybShcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCIpO1xyXG4gICAgICAgICAgICAgICAgdGVybS5tb3ZlVG8oeE9mZnNldCwgdGVybVhZLmdldFdvcmQueSArIDEpO1xyXG4gICAgICAgICAgICAgICAgdGVybShcIiAgICAgICAgICAgICAgICAgICAgXCIpO1xyXG4gICAgICAgICAgICAgICAgdGVybS5tb3ZlVG8odGVybVhZLmdldFdvcmQueCwgdGVybVhZLmdldFdvcmQueSk7XHJcbiAgICAgICAgICAgICAgICB0ZXJtKFwiR3Vlc3MgXCIgKyBpbnB1dCArIFwiIHdhcyB3cm9uZyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIik7XHJcbiAgICAgICAgICAgICAgICAvLyBtb3ZlIGN1cnNvciBiYWNrIHRvIGlucHV0IHBvc2l0aW9uXHJcbiAgICAgICAgICAgICAgICB0ZXJtLm1vdmVUbyh0ZXJtWFkuaW5wdXQueCwgdGVybVhZLmlucHV0LnkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGxldCB0aGUgZXZlbnQgbGlzdGVuZXIgd29yayBhZ2FpblxyXG4gICAgICAgIHJlYWRXb3JkID0gZmFsc2U7XHJcbiAgICB9KTtcclxufVxyXG4vLyBmdW5jdGlvbiBjYWxsZWQgd2hlbiBhIGtleSBpcyBwcmVzc2VkIGluIHJhdyBtb2RlXHJcbmZ1bmN0aW9uIHByb2Nlc3NJbnB1dCggY2hhcjpzdHJpbmcpOnZvaWQge1xyXG4gICAgY29uc3QgcmVnZXhwID0gbmV3IFJlZ0V4cChcIlthLXpdXCIsIFwiaVwiKTtcclxuICAgIGlmICggY2hhciA9PT0gXCJFTlRFUlwiKSB7XHJcbiAgICAgICAgLy8gbWFrZSBhIGd1ZXNzIGF0IHRoZSB3b3JkXHJcbiAgICAgICAgZ3Vlc3NXb3JkKCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggKGNoYXIubGVuZ3RoID09PSAxKSAmJiAocmVnZXhwLnRlc3QoY2hhcikpKSB7XHJcbiAgICAgICAgY29uc3QgbGNDaGFyID0gY2hhci50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwidmFsaWQgaW5wdXQgXCIgKyBjaGFyKTtcclxuICAgICAgICAvLyBjaGVjayB0byBzZWUgd2hldGhlciBsZXR0ZXIgaGFzIGFscmVhZHkgYmVlbiBzZWxlY3RlZFxyXG4gICAgICAgIGlmIChfLmluZGV4T2YobGV0dGVyc0Nob3NlbixsY0NoYXIpID4gMCkge1xyXG4gICAgICAgICAgICAvLyBkb24ndCBwcm9jZXNzIGFueXRoaW5nIGJlY2F1c2UgbGV0dGVyIGhhcyBhbHJlYWR5IGJlZW4gc2VsZWN0ZWRcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoZVdvcmQuY2hlY2tDaGFyKGxjQ2hhcik7XHJcbiAgICAgICAgICAgIGxldHRlcnNDaG9zZW4ucHVzaChsY0NoYXIpO1xyXG4gICAgICAgICAgICAvLyBjaGVjayB0byBzZWUgaWYgd29yZCBpcyBjb21wbGV0ZWRcclxuICAgICAgICAgICAgaWYgKHRoZVdvcmQud29yZDJzdHJpbmcoKS5pbmNsdWRlcyhcIl9cIikpIHtcclxuICAgICAgICAgICAgICAgIC8vIG5vdCBjb21wbGV0ZWRcclxuICAgICAgICAgICAgICAgIHNob3dXb3JkKCk7XHJcbiAgICAgICAgICAgICAgICBzaG93TGV0dGVyc0Nob3NlbigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2hvd1dvcmQoKTtcclxuICAgICAgICAgICAgICAgIHNob3dMZXR0ZXJzQ2hvc2VuKCk7XHJcbiAgICAgICAgICAgICAgICB3b3JkQ29tcGxldGVkKCk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBhbnkgb3RoZXIga2V5IHByZXNzZWQgZG9lcyBub3RoaW5nICBcclxufVxyXG5cclxuZnVuY3Rpb24gd29yZENvbXBsZXRlZCgpOnZvaWQge1xyXG4gICAgLy8gZXJhc2UgZ3Vlc3NlZCB3b3JkXHJcbiAgICB0ZXJtLm1vdmVUbyh0ZXJtWFkuZ2V0V29yZC54LCB0ZXJtWFkuZ2V0V29yZC55KTtcclxuICAgIHRlcm0oXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIik7XHJcbiAgICB0ZXJtLm1vdmVUbyh0ZXJtWFkuY2hvb3NlQWdhaW4ueCwgdGVybVhZLmNob29zZUFnYWluLnkpO1xyXG4gICAgdGVybShcImNvbXBsZXRlZCB3b3JkIFwiKyB0aGVXb3JkLndvcmQyRnVsbFN0cmluZygpKTtcclxuICAgIHRlcm0oXCIgQW5vdGhlciBnYW1lID8gKFkvbilcIik7XHJcbiAgICByZWFkV29yZCA9IHRydWU7IC8vIG5vdCByZWFsbHkgcmVhZGluZyB3b3JkIGJ1dCBkaXNhYmxlcyBrZXkgZXZlbnRcclxuICAgIHRlcm0ueWVzT3JObyh7IHllczogWyd5JywgJ1knLCdFTlRFUiddLCBubzogWyduJywgJ04nXSB9LCBmdW5jdGlvbiAoZXJyb3IsIHJlc3VsdCkge1xyXG4gICAgICAgIGlmIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgcmVhZFdvcmQgPSBmYWxzZTsgLy8gcmUtZW5hYmxlZCBrZXkgZXZlbnRcclxuICAgICAgICAgICAgc3RhcnQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGV4aXRHYW1lKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBcclxufVxyXG5cclxuZnVuY3Rpb24gc3RhcnQoKTp2b2lkIHsgIFxyXG4gICAgY2hvb3NlV29yZCgpO1xyXG4gICAgbGV0dGVyc0Nob3NlbiA9IFtdO1xyXG4gICAgc2V0dXBUZXJtaW5hbCgpO1xyXG4gICAgc2hvd1dvcmQoKTtcclxuICAgIHNob3dMZXR0ZXJzQ2hvc2VuKCk7XHJcbiAgICAvLyBhZnRlciBzZXR1cCwgcHJvZ3JhbSBpcyBkcml2ZW4gYnkga2V5IHByZXNzZXNcclxufVxyXG5cclxuXHJcblxyXG4vLyBzaG93V29yZCgpO1xyXG4vLyBzaG93TGV0dGVyc0Nob3NlbigpO1xyXG4vLyBnZXRJbnB1dCgpO1xyXG5cclxuc3RhcnQoKTtcclxuXHJcbi8vIGNvbnNvbGUubG9nKHRoZVdvcmQpO1xyXG5cclxuLy8gc2V0IHRlcm1pbmFsIHVwIHRvIHJlYWQga2V5IHByZXNzZXNcclxudGVybS5ncmFiSW5wdXQodHJ1ZSk7XHJcblxyXG4vLyBzZXQgd2F0Y2hlciBvbiBrZXkgaW5wdXRcclxudGVybS5vbigna2V5JywgZnVuY3Rpb24gKG5hbWU6c3RyaW5nLCBtYXRjaGVzOmFueSwgZGF0YTphbnkpIHtcclxuICAgIGlmIChuYW1lID09PSAnQ1RSTF9DJykge1xyXG4gICAgICAgIGV4aXRHYW1lKFwiQ29udHJvbCBDIHByZXNzZWQgLSBleGl0aW5nIGdhbWVcIik7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIidrZXknIGV2ZW50OlwiICsgbmFtZSArIFwiIG1hdGNoZXMgXCIgKyBtYXRjaGVzICsgXCIgZGF0YSBcIiArIGRhdGEpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmICghcmVhZFdvcmQpIHtcclxuICAgICAgICAgICAgcHJvY2Vzc0lucHV0KG5hbWUpO1xyXG4gICAgICAgIH0gXHJcbiAgICB9XHJcbn0pO1xyXG5cclxuXHJcblxyXG4iXX0=
