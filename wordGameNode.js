// main program for node based word guessing game
import * as _ from "lodash";
import Word from "./word";
import { terminal as term } from "terminal-kit";
// global variables and constants
const wordsArr = [
    "javascript",
    "html",
    "mongo",
    "chrome",
    "node",
    "css"
];
// offsets the instructions from left hand side
const xOffset = 5;
// object to hold x,y locations of inputs and outputs for use by terminal-kit
const termXY = {
    chosenLetters: { x: 25, y: 12 },
    wordSoFar: { x: 25, y: 16 },
    getWord: { x: 25, y: 20 },
    input: { x: 25, y: 18 },
    chooseAgain: { x: 25, y: 23 },
    guesses: { x: 25, y: 11 },
    title: { x: 30, y: 2 },
    instructions: { x: 5, y: 4 }
};
// can't seem to turn off the event listener so using a global variable to make it doesn't return anything
var readWord = false;
// holds the word selected by random from wordsArr
var theWord;
// array to hold the letters chosen
var lettersChosen = [];
// number of guesses and max allowed
var guesses = -1; // referenced through incGuesses function which always increments so start at -1
const maxGuesses = 10;
//////////////////////////////////////////////////////////////////////////////////////////////////////////////
// functions
// randomly choose a word from wordsArr
function chooseWord() {
    let random = _.random(0, (wordsArr.length - 1));
    theWord = new Word(wordsArr[random]);
}
// clears the screen and then prints out instructions and information
function setupTerminal() {
    term.clear();
    // write information to screen
    // title
    term.moveTo(termXY.title.x, termXY.title.y);
    term.bold("Word Game");
    // instructions
    term.moveTo(termXY.instructions.x, termXY.instructions.y);
    term("Instructions:\n");
    term("         Press keys to guess letters, you have " + maxGuesses + " attempts\n");
    term("         press RETURN to guess at the word (takes up 1 attempt)\n");
    term("         press control-C to end the game at any time");
    term.moveTo(xOffset, termXY.input.y);
    term("Type letters");
    term.moveTo(xOffset, termXY.chosenLetters.y);
    term("Letters chosen ");
    term.moveTo(xOffset, termXY.wordSoFar.y);
    term("Word so far ");
    // move cursor to input position
    term.moveTo(termXY.input.x, termXY.input.y);
}
function showWord() {
    let word = theWord.word2string();
    term.moveTo(termXY.wordSoFar.x, termXY.wordSoFar.y);
    term(word);
    // want to know how many characters
    term("  (" + theWord.letterArr.length + " characters)");
    term.moveTo(termXY.input.x, termXY.input.y);
}
function showLettersChosen() {
    term.moveTo(termXY.chosenLetters.x, termXY.chosenLetters.y);
    term(lettersChosen.join(","));
    term.moveTo(termXY.input.x, termXY.input.y);
}
function exitGame(message) {
    // move down 10 lines
    term.nextLine(10);
    if (message !== undefined) {
        console.log(String(message));
    }
    // using this exit resets any strange stuff the terminal is doing
    term.processExit(0);
}
function incGuess() {
    guesses += 1;
    if (guesses > maxGuesses) {
        // too many guesses
        term.moveTo(termXY.chooseAgain.x, termXY.chooseAgain.y);
        term("Too many guesses, you lose. ");
        term(" Another game ? (Y/n)");
        readWord = true; // not really reading word but disables key event
        term.yesOrNo({ yes: ['y', 'Y', 'ENTER'], no: ['n', 'N'] }, function (error, result) {
            if (result) {
                readWord = false; // re-enabled key event
                start();
            }
            else {
                exitGame();
            }
        });
    }
    else {
        term.moveTo(termXY.guesses.x, termXY.guesses.y);
        term(guesses + "/" + maxGuesses + " guesses");
        // move cursor back to input position
        term.moveTo(termXY.input.x, termXY.input.y);
    }
}
// function to allow user to make a guess at the whole word
// this still has a BUG
function guessWord() {
    term.moveTo(xOffset, termXY.getWord.y);
    term("Guess the word ");
    term.moveTo(xOffset, termXY.getWord.y + 1);
    term("(RETURN to finish)");
    // move cursor to word input position
    term.moveTo(termXY.getWord.x, termXY.getWord.y);
    // erase what was there
    term("                                     ");
    debugger;
    term.moveTo(termXY.getWord.x, termXY.getWord.y);
    // term("Here " + termXY.getWord.x + "," + termXY.getWord.y);
    // term.moveTo(termXY.getWord.x, termXY.getWord.y + 5);
    // turn off the key event listener using global variable
    readWord = true;
    term.inputField({}, function (error, input) {
        if (error) {
            exitGame(term.red.str("\nAn error occurred reading input field: " + error + "\n"));
        }
        else {
            if (input === theWord.word2FullString()) {
                // guessed right
                readWord = false;
                wordCompleted();
            }
            else {
                // erase the instructions
                term.moveTo(xOffset, termXY.getWord.y);
                term("                                   ");
                term.moveTo(xOffset, termXY.getWord.y + 1);
                term("                    ");
                // BUG fix, erase the typing at the key input locations
                term.moveTo(termXY.input.x, termXY.input.y);
                term("                                ");
                // let user know what happened
                term.moveTo(termXY.getWord.x, termXY.getWord.y);
                term("Guess \"" + input + "\" was wrong                                  ");
                // move cursor back to input position
                term.moveTo(termXY.input.x, termXY.input.y);
                // let the event listener work again
                readWord = false;
            }
        }
    });
}
// function called when a key is pressed in raw mode
function processInput(char) {
    const regexp = new RegExp("[a-z]", "i");
    if (char === "ENTER") {
        // make a guess at the word
        guessWord();
        incGuess();
    }
    else if ((char.length === 1) && (regexp.test(char))) {
        const lcChar = char.toLowerCase();
        // check to see whether letter has already been selected
        if (_.indexOf(lettersChosen, lcChar) > -1) {
            // don't process anything because letter has already been selected
        }
        else {
            incGuess();
            theWord.checkChar(lcChar);
            lettersChosen.push(lcChar);
            // check to see if word is completed
            if (theWord.word2string().includes("_")) {
                // not completed
                showWord();
                showLettersChosen();
            }
            else {
                showWord();
                showLettersChosen();
                wordCompleted();
            }
        }
    }
    // any other key pressed does nothing  
}
function wordCompleted() {
    // erase guessed word
    term.moveTo(termXY.getWord.x, termXY.getWord.y);
    term("                                          ");
    term.moveTo(termXY.chooseAgain.x, termXY.chooseAgain.y);
    term("completed word \"" + theWord.word2FullString() + "\"");
    term(" Another game ? (Y/n)");
    readWord = true; // not really reading word but disables key event
    term.yesOrNo({ yes: ['y', 'Y', 'ENTER'], no: ['n', 'N'] }, function (error, result) {
        if (result) {
            readWord = false; // re-enabled key event
            start();
        }
        else {
            exitGame();
        }
    });
}
function start() {
    chooseWord();
    lettersChosen = [];
    guesses = -1; // referenced through incGuesses function which always increments so start at -1
    setupTerminal();
    showWord();
    showLettersChosen();
    incGuess(); // increments to 0 and displays number of guesses
    // after setup, program is driven by key presses
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////
// main program
start();
// set terminal up to read key presses
term.grabInput(true);
// set watcher on key input
term.on('key', function (name, matches, data) {
    if (name === 'CTRL_C') {
        exitGame("Control C pressed - exiting game");
    }
    else {
        // console.log("'key' event:" + name + " matches " + matches + " data " + data);
        if (!readWord) {
            processInput(name);
        }
    }
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndvcmRHYW1lTm9kZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxpREFBaUQ7QUFFakQsT0FBTyxLQUFLLENBQUMsTUFBTSxRQUFRLENBQUM7QUFDNUIsT0FBTyxJQUFJLE1BQU0sUUFBUSxDQUFDO0FBQzFCLE9BQU8sRUFBQyxRQUFRLElBQUksSUFBSSxFQUFDLE1BQU0sY0FBYyxDQUFDO0FBRzlDLGlDQUFpQztBQUNqQyxNQUFNLFFBQVEsR0FBRztJQUNiLFlBQVk7SUFDWixNQUFNO0lBQ04sT0FBTztJQUNQLFFBQVE7SUFDUixNQUFNO0lBQ04sS0FBSztDQUNSLENBQUM7QUFFRiwrQ0FBK0M7QUFDL0MsTUFBTSxPQUFPLEdBQUcsQ0FBQyxDQUFDO0FBQ2xCLDZFQUE2RTtBQUM3RSxNQUFNLE1BQU0sR0FBRztJQUNYLGFBQWEsRUFBRSxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBQztJQUM1QixTQUFTLEVBQU0sRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUM7SUFDNUIsT0FBTyxFQUFRLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFDO0lBQzVCLEtBQUssRUFBVSxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBQztJQUM1QixXQUFXLEVBQUksRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUM7SUFDNUIsT0FBTyxFQUFRLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFDO0lBQzVCLEtBQUssRUFBVSxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUUsQ0FBQyxFQUFDLENBQUMsRUFBQztJQUMzQixZQUFZLEVBQUcsRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFHLENBQUMsRUFBQyxDQUFDLEVBQUM7Q0FDOUIsQ0FBQztBQUdGLDBHQUEwRztBQUMxRyxJQUFJLFFBQVEsR0FBRyxLQUFLLENBQUM7QUFDckIsa0RBQWtEO0FBQ2xELElBQUksT0FBWSxDQUFDO0FBRWpCLG1DQUFtQztBQUNuQyxJQUFJLGFBQWEsR0FBWSxFQUFFLENBQUM7QUFFaEMsb0NBQW9DO0FBQ3BDLElBQUksT0FBTyxHQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsZ0ZBQWdGO0FBQ3pHLE1BQU0sVUFBVSxHQUFVLEVBQUUsQ0FBQztBQUU3Qiw4R0FBOEc7QUFDOUcsWUFBWTtBQUVaLHVDQUF1QztBQUN2QyxTQUFTLFVBQVU7SUFDZixJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUUsQ0FBQyxDQUFFLENBQUMsQ0FBQztJQUNoRCxPQUFPLEdBQUcsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7QUFFekMsQ0FBQztBQUVELHFFQUFxRTtBQUNyRSxTQUFTLGFBQWE7SUFDbEIsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ2IsOEJBQThCO0lBQzlCLFFBQVE7SUFDUixJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDNUMsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUN2QixlQUFlO0lBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzFELElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0lBQ3hCLElBQUksQ0FBQyxpREFBaUQsR0FBRyxVQUFVLEdBQUcsYUFBYSxDQUFDLENBQUM7SUFDckYsSUFBSSxDQUFDLG1FQUFtRSxDQUFDLENBQUM7SUFDMUUsSUFBSSxDQUFDLHNEQUFzRCxDQUFDLENBQUM7SUFDN0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNwQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDckIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM3QyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUN4QixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3pDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUNyQixnQ0FBZ0M7SUFDaEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBRWhELENBQUM7QUFHRCxTQUFTLFFBQVE7SUFDYixJQUFJLElBQUksR0FBVSxPQUFPLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDeEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BELElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNYLG1DQUFtQztJQUNuQyxJQUFJLENBQUMsS0FBSyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLGNBQWMsQ0FBQyxDQUFDO0lBQ3hELElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNoRCxDQUFDO0FBRUQsU0FBUyxpQkFBaUI7SUFDdEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzVELElBQUksQ0FBRSxhQUFhLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDL0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ2hELENBQUM7QUFFRCxTQUFTLFFBQVEsQ0FBQyxPQUFhO0lBQzNCLHFCQUFxQjtJQUNyQixJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2xCLElBQUksT0FBTyxLQUFLLFNBQVMsRUFBRTtRQUN2QixPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0tBQ2hDO0lBQ0QsaUVBQWlFO0lBQ2pFLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDeEIsQ0FBQztBQUVELFNBQVMsUUFBUTtJQUNiLE9BQU8sSUFBSSxDQUFDLENBQUM7SUFDYixJQUFJLE9BQU8sR0FBRyxVQUFVLEVBQUU7UUFDdEIsbUJBQW1CO1FBQ25CLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN4RCxJQUFJLENBQUMsOEJBQThCLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsQ0FBQztRQUM5QixRQUFRLEdBQUcsSUFBSSxDQUFDLENBQUMsaURBQWlEO1FBQ2xFLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLE9BQU8sQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxFQUFFLFVBQVUsS0FBSyxFQUFFLE1BQU07WUFDOUUsSUFBSSxNQUFNLEVBQUU7Z0JBQ1IsUUFBUSxHQUFHLEtBQUssQ0FBQyxDQUFDLHVCQUF1QjtnQkFDekMsS0FBSyxFQUFFLENBQUM7YUFDWDtpQkFDSTtnQkFDRCxRQUFRLEVBQUUsQ0FBQzthQUNkO1FBQ0wsQ0FBQyxDQUFDLENBQUM7S0FDTjtTQUNJO1FBQ0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2hELElBQUksQ0FBQyxPQUFPLEdBQUcsR0FBRyxHQUFHLFVBQVUsR0FBRyxVQUFVLENBQUMsQ0FBQztRQUM5QyxxQ0FBcUM7UUFDckMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBRS9DO0FBQ0wsQ0FBQztBQUVELDJEQUEyRDtBQUMzRCx1QkFBdUI7QUFDdkIsU0FBUyxTQUFTO0lBQ2QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN2QyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUN4QixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUMzQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQztJQUMzQixxQ0FBcUM7SUFDckMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2hELHVCQUF1QjtJQUN2QixJQUFJLENBQUMsdUNBQXVDLENBQUMsQ0FBQztJQUM5QyxRQUFRLENBQUM7SUFDVCxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDaEQsNkRBQTZEO0lBQzdELHVEQUF1RDtJQUN2RCx3REFBd0Q7SUFDeEQsUUFBUSxHQUFHLElBQUksQ0FBQztJQUNoQixJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsRUFBQyxVQUFVLEtBQVUsRUFBRSxLQUFhO1FBQ2xELElBQUksS0FBSyxFQUFFO1lBQ1AsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLDJDQUEyQyxHQUFHLEtBQUssR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO1NBQ3RGO2FBQ0k7WUFDRCxJQUFJLEtBQUssS0FBSyxPQUFPLENBQUMsZUFBZSxFQUFFLEVBQUU7Z0JBQ3JDLGdCQUFnQjtnQkFDaEIsUUFBUSxHQUFHLEtBQUssQ0FBQztnQkFDakIsYUFBYSxFQUFFLENBQUM7YUFDbkI7aUJBQ0k7Z0JBQ0QseUJBQXlCO2dCQUN6QixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN2QyxJQUFJLENBQUMscUNBQXFDLENBQUMsQ0FBQztnQkFDNUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQzNDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO2dCQUM3Qix1REFBdUQ7Z0JBQ3ZELElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDNUMsSUFBSSxDQUFDLGtDQUFrQyxDQUFDLENBQUM7Z0JBQ3pDLDhCQUE4QjtnQkFDOUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNoRCxJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssR0FBRyxnREFBZ0QsQ0FBQyxDQUFDO2dCQUM1RSxxQ0FBcUM7Z0JBQ3JDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDNUMsb0NBQW9DO2dCQUNwQyxRQUFRLEdBQUcsS0FBSyxDQUFDO2FBQ3BCO1NBQ0o7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUM7QUFDRCxvREFBb0Q7QUFDcEQsU0FBUyxZQUFZLENBQUUsSUFBVztJQUM5QixNQUFNLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDeEMsSUFBSyxJQUFJLEtBQUssT0FBTyxFQUFFO1FBQ25CLDJCQUEyQjtRQUMzQixTQUFTLEVBQUUsQ0FBQztRQUNaLFFBQVEsRUFBRSxDQUFDO0tBQ2Q7U0FDSSxJQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRTtRQUNsRCxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDbEMsd0RBQXdEO1FBQ3hELElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUU7WUFDdEMsa0VBQWtFO1NBQ3JFO2FBQ0k7WUFDRCxRQUFRLEVBQUUsQ0FBQztZQUNYLE9BQU8sQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDMUIsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMzQixvQ0FBb0M7WUFDcEMsSUFBSSxPQUFPLENBQUMsV0FBVyxFQUFFLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUNyQyxnQkFBZ0I7Z0JBQ2hCLFFBQVEsRUFBRSxDQUFDO2dCQUNYLGlCQUFpQixFQUFFLENBQUM7YUFDdkI7aUJBQ0k7Z0JBQ0QsUUFBUSxFQUFFLENBQUM7Z0JBQ1gsaUJBQWlCLEVBQUUsQ0FBQztnQkFDcEIsYUFBYSxFQUFFLENBQUM7YUFFbkI7U0FFSjtLQUNKO0lBQ0QsdUNBQXVDO0FBQzNDLENBQUM7QUFFRCxTQUFTLGFBQWE7SUFDbEIscUJBQXFCO0lBQ3JCLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNoRCxJQUFJLENBQUMsNENBQTRDLENBQUMsQ0FBQztJQUNuRCxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDeEQsSUFBSSxDQUFDLG1CQUFtQixHQUFFLE9BQU8sQ0FBQyxlQUFlLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztJQUM1RCxJQUFJLENBQUMsdUJBQXVCLENBQUMsQ0FBQztJQUM5QixRQUFRLEdBQUcsSUFBSSxDQUFDLENBQUMsaURBQWlEO0lBQ2xFLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxFQUFFLFVBQVUsS0FBSyxFQUFFLE1BQU07UUFDN0UsSUFBSSxNQUFNLEVBQUU7WUFDUixRQUFRLEdBQUcsS0FBSyxDQUFDLENBQUMsdUJBQXVCO1lBQ3pDLEtBQUssRUFBRSxDQUFDO1NBQ1g7YUFDSTtZQUNELFFBQVEsRUFBRSxDQUFDO1NBQ2Q7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUVQLENBQUM7QUFFRCxTQUFTLEtBQUs7SUFDVixVQUFVLEVBQUUsQ0FBQztJQUNiLGFBQWEsR0FBRyxFQUFFLENBQUM7SUFDbkIsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsZ0ZBQWdGO0lBQzlGLGFBQWEsRUFBRSxDQUFDO0lBQ2hCLFFBQVEsRUFBRSxDQUFDO0lBQ1gsaUJBQWlCLEVBQUUsQ0FBQztJQUNwQixRQUFRLEVBQUUsQ0FBQyxDQUFDLGlEQUFpRDtJQUU3RCxnREFBZ0Q7QUFDcEQsQ0FBQztBQUVELDhHQUE4RztBQUM5RyxlQUFlO0FBQ2YsS0FBSyxFQUFFLENBQUM7QUFFUixzQ0FBc0M7QUFDdEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUVyQiwyQkFBMkI7QUFDM0IsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsVUFBVSxJQUFXLEVBQUUsT0FBVyxFQUFFLElBQVE7SUFDdkQsSUFBSSxJQUFJLEtBQUssUUFBUSxFQUFFO1FBQ25CLFFBQVEsQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO0tBQ2hEO1NBQ0k7UUFDRCxnRkFBZ0Y7UUFFaEYsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNYLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUN0QjtLQUNKO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoid29yZEdhbWVOb2RlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gbWFpbiBwcm9ncmFtIGZvciBub2RlIGJhc2VkIHdvcmQgZ3Vlc3NpbmcgZ2FtZVxuXG5pbXBvcnQgKiBhcyBfIGZyb20gXCJsb2Rhc2hcIjtcbmltcG9ydCBXb3JkIGZyb20gXCIuL3dvcmRcIjtcbmltcG9ydCB7dGVybWluYWwgYXMgdGVybX0gZnJvbSBcInRlcm1pbmFsLWtpdFwiO1xuXG5cbi8vIGdsb2JhbCB2YXJpYWJsZXMgYW5kIGNvbnN0YW50c1xuY29uc3Qgd29yZHNBcnIgPSBbXG4gICAgXCJqYXZhc2NyaXB0XCIsXG4gICAgXCJodG1sXCIsXG4gICAgXCJtb25nb1wiLFxuICAgIFwiY2hyb21lXCIsXG4gICAgXCJub2RlXCIsXG4gICAgXCJjc3NcIlxuXTtcblxuLy8gb2Zmc2V0cyB0aGUgaW5zdHJ1Y3Rpb25zIGZyb20gbGVmdCBoYW5kIHNpZGVcbmNvbnN0IHhPZmZzZXQgPSA1O1xuLy8gb2JqZWN0IHRvIGhvbGQgeCx5IGxvY2F0aW9ucyBvZiBpbnB1dHMgYW5kIG91dHB1dHMgZm9yIHVzZSBieSB0ZXJtaW5hbC1raXRcbmNvbnN0IHRlcm1YWSA9IHtcbiAgICBjaG9zZW5MZXR0ZXJzOiB7IHg6MjUsIHk6MTJ9LFxuICAgIHdvcmRTb0ZhcjogICAgIHsgeDoyNSwgeToxNn0sXG4gICAgZ2V0V29yZDogICAgICAgeyB4OjI1LCB5OjIwfSxcbiAgICBpbnB1dDogICAgICAgICB7IHg6MjUsIHk6MTh9LFxuICAgIGNob29zZUFnYWluOiAgIHsgeDoyNSwgeToyM30sXG4gICAgZ3Vlc3NlczogICAgICAgeyB4OjI1LCB5OjExfSxcbiAgICB0aXRsZTogICAgICAgICB7IHg6MzAsIHk6Mn0sXG4gICAgaW5zdHJ1Y3Rpb25zOiAgeyB4OjUsICB5OjR9XG59O1xuXG5cbi8vIGNhbid0IHNlZW0gdG8gdHVybiBvZmYgdGhlIGV2ZW50IGxpc3RlbmVyIHNvIHVzaW5nIGEgZ2xvYmFsIHZhcmlhYmxlIHRvIG1ha2UgaXQgZG9lc24ndCByZXR1cm4gYW55dGhpbmdcbnZhciByZWFkV29yZCA9IGZhbHNlO1xuLy8gaG9sZHMgdGhlIHdvcmQgc2VsZWN0ZWQgYnkgcmFuZG9tIGZyb20gd29yZHNBcnJcbnZhciB0aGVXb3JkOldvcmQ7XG5cbi8vIGFycmF5IHRvIGhvbGQgdGhlIGxldHRlcnMgY2hvc2VuXG52YXIgbGV0dGVyc0Nob3NlbjpzdHJpbmdbXSA9IFtdO1xuXG4vLyBudW1iZXIgb2YgZ3Vlc3NlcyBhbmQgbWF4IGFsbG93ZWRcbnZhciBndWVzc2VzOm51bWJlciA9IC0xOyAvLyByZWZlcmVuY2VkIHRocm91Z2ggaW5jR3Vlc3NlcyBmdW5jdGlvbiB3aGljaCBhbHdheXMgaW5jcmVtZW50cyBzbyBzdGFydCBhdCAtMVxuY29uc3QgbWF4R3Vlc3NlczpudW1iZXIgPSAxMDtcblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIGZ1bmN0aW9uc1xuXG4vLyByYW5kb21seSBjaG9vc2UgYSB3b3JkIGZyb20gd29yZHNBcnJcbmZ1bmN0aW9uIGNob29zZVdvcmQgKCkge1xuICAgIGxldCByYW5kb20gPSBfLnJhbmRvbSgwLCAod29yZHNBcnIubGVuZ3RoIC0xICkpO1xuICAgIHRoZVdvcmQgPSBuZXcgV29yZCh3b3Jkc0FycltyYW5kb21dKTtcbiAgICBcbn1cblxuLy8gY2xlYXJzIHRoZSBzY3JlZW4gYW5kIHRoZW4gcHJpbnRzIG91dCBpbnN0cnVjdGlvbnMgYW5kIGluZm9ybWF0aW9uXG5mdW5jdGlvbiBzZXR1cFRlcm1pbmFsKCk6dm9pZCB7XG4gICAgdGVybS5jbGVhcigpO1xuICAgIC8vIHdyaXRlIGluZm9ybWF0aW9uIHRvIHNjcmVlblxuICAgIC8vIHRpdGxlXG4gICAgdGVybS5tb3ZlVG8odGVybVhZLnRpdGxlLngsIHRlcm1YWS50aXRsZS55KTtcbiAgICB0ZXJtLmJvbGQoXCJXb3JkIEdhbWVcIik7XG4gICAgLy8gaW5zdHJ1Y3Rpb25zXG4gICAgdGVybS5tb3ZlVG8odGVybVhZLmluc3RydWN0aW9ucy54LCB0ZXJtWFkuaW5zdHJ1Y3Rpb25zLnkpO1xuICAgIHRlcm0oXCJJbnN0cnVjdGlvbnM6XFxuXCIpO1xuICAgIHRlcm0oXCIgICAgICAgICBQcmVzcyBrZXlzIHRvIGd1ZXNzIGxldHRlcnMsIHlvdSBoYXZlIFwiICsgbWF4R3Vlc3NlcyArIFwiIGF0dGVtcHRzXFxuXCIpO1xuICAgIHRlcm0oXCIgICAgICAgICBwcmVzcyBSRVRVUk4gdG8gZ3Vlc3MgYXQgdGhlIHdvcmQgKHRha2VzIHVwIDEgYXR0ZW1wdClcXG5cIik7XG4gICAgdGVybShcIiAgICAgICAgIHByZXNzIGNvbnRyb2wtQyB0byBlbmQgdGhlIGdhbWUgYXQgYW55IHRpbWVcIik7XG4gICAgdGVybS5tb3ZlVG8oeE9mZnNldCx0ZXJtWFkuaW5wdXQueSk7XG4gICAgdGVybShcIlR5cGUgbGV0dGVyc1wiKTtcbiAgICB0ZXJtLm1vdmVUbyh4T2Zmc2V0LCB0ZXJtWFkuY2hvc2VuTGV0dGVycy55KTtcbiAgICB0ZXJtKFwiTGV0dGVycyBjaG9zZW4gXCIpO1xuICAgIHRlcm0ubW92ZVRvKHhPZmZzZXQsIHRlcm1YWS53b3JkU29GYXIueSk7XG4gICAgdGVybShcIldvcmQgc28gZmFyIFwiKTtcbiAgICAvLyBtb3ZlIGN1cnNvciB0byBpbnB1dCBwb3NpdGlvblxuICAgIHRlcm0ubW92ZVRvKHRlcm1YWS5pbnB1dC54LCB0ZXJtWFkuaW5wdXQueSk7XG5cbn1cblxuXG5mdW5jdGlvbiBzaG93V29yZCgpOnZvaWQge1xuICAgIGxldCB3b3JkOnN0cmluZyA9IHRoZVdvcmQud29yZDJzdHJpbmcoKTtcbiAgICB0ZXJtLm1vdmVUbyh0ZXJtWFkud29yZFNvRmFyLngsIHRlcm1YWS53b3JkU29GYXIueSk7XG4gICAgdGVybSh3b3JkKTtcbiAgICAvLyB3YW50IHRvIGtub3cgaG93IG1hbnkgY2hhcmFjdGVyc1xuICAgIHRlcm0oXCIgIChcIiArIHRoZVdvcmQubGV0dGVyQXJyLmxlbmd0aCArIFwiIGNoYXJhY3RlcnMpXCIpO1xuICAgIHRlcm0ubW92ZVRvKHRlcm1YWS5pbnB1dC54LCB0ZXJtWFkuaW5wdXQueSk7XG59XG5cbmZ1bmN0aW9uIHNob3dMZXR0ZXJzQ2hvc2VuICgpOnZvaWQge1xuICAgIHRlcm0ubW92ZVRvKHRlcm1YWS5jaG9zZW5MZXR0ZXJzLngsIHRlcm1YWS5jaG9zZW5MZXR0ZXJzLnkpO1xuICAgIHRlcm0oIGxldHRlcnNDaG9zZW4uam9pbihcIixcIikpO1xuICAgIHRlcm0ubW92ZVRvKHRlcm1YWS5pbnB1dC54LCB0ZXJtWFkuaW5wdXQueSk7XG59XG5cbmZ1bmN0aW9uIGV4aXRHYW1lKG1lc3NhZ2U/OiBhbnkpOiB2b2lkIHtcbiAgICAvLyBtb3ZlIGRvd24gMTAgbGluZXNcbiAgICB0ZXJtLm5leHRMaW5lKDEwKTtcbiAgICBpZiAobWVzc2FnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFN0cmluZyhtZXNzYWdlKSk7XG4gICAgfVxuICAgIC8vIHVzaW5nIHRoaXMgZXhpdCByZXNldHMgYW55IHN0cmFuZ2Ugc3R1ZmYgdGhlIHRlcm1pbmFsIGlzIGRvaW5nXG4gICAgdGVybS5wcm9jZXNzRXhpdCgwKTtcbn1cblxuZnVuY3Rpb24gaW5jR3Vlc3MoKTp2b2lkIHtcbiAgICBndWVzc2VzICs9IDE7XG4gICAgaWYgKGd1ZXNzZXMgPiBtYXhHdWVzc2VzKSB7XG4gICAgICAgIC8vIHRvbyBtYW55IGd1ZXNzZXNcbiAgICAgICAgdGVybS5tb3ZlVG8odGVybVhZLmNob29zZUFnYWluLngsIHRlcm1YWS5jaG9vc2VBZ2Fpbi55KTtcbiAgICAgICAgdGVybShcIlRvbyBtYW55IGd1ZXNzZXMsIHlvdSBsb3NlLiBcIik7XG4gICAgICAgIHRlcm0oXCIgQW5vdGhlciBnYW1lID8gKFkvbilcIik7XG4gICAgICAgIHJlYWRXb3JkID0gdHJ1ZTsgLy8gbm90IHJlYWxseSByZWFkaW5nIHdvcmQgYnV0IGRpc2FibGVzIGtleSBldmVudFxuICAgICAgICB0ZXJtLnllc09yTm8oeyB5ZXM6IFsneScsICdZJywgJ0VOVEVSJ10sIG5vOiBbJ24nLCAnTiddIH0sIGZ1bmN0aW9uIChlcnJvciwgcmVzdWx0KSB7XG4gICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgcmVhZFdvcmQgPSBmYWxzZTsgLy8gcmUtZW5hYmxlZCBrZXkgZXZlbnRcbiAgICAgICAgICAgICAgICBzdGFydCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZXhpdEdhbWUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB0ZXJtLm1vdmVUbyh0ZXJtWFkuZ3Vlc3Nlcy54LCB0ZXJtWFkuZ3Vlc3Nlcy55KTtcbiAgICAgICAgdGVybShndWVzc2VzICsgXCIvXCIgKyBtYXhHdWVzc2VzICsgXCIgZ3Vlc3Nlc1wiKTtcbiAgICAgICAgLy8gbW92ZSBjdXJzb3IgYmFjayB0byBpbnB1dCBwb3NpdGlvblxuICAgICAgICB0ZXJtLm1vdmVUbyh0ZXJtWFkuaW5wdXQueCwgdGVybVhZLmlucHV0LnkpO1xuICAgICAgICBcbiAgICB9XG59XG5cbi8vIGZ1bmN0aW9uIHRvIGFsbG93IHVzZXIgdG8gbWFrZSBhIGd1ZXNzIGF0IHRoZSB3aG9sZSB3b3JkXG4vLyB0aGlzIHN0aWxsIGhhcyBhIEJVR1xuZnVuY3Rpb24gZ3Vlc3NXb3JkKCk6dm9pZCB7XG4gICAgdGVybS5tb3ZlVG8oeE9mZnNldCwgdGVybVhZLmdldFdvcmQueSk7XG4gICAgdGVybShcIkd1ZXNzIHRoZSB3b3JkIFwiKTtcbiAgICB0ZXJtLm1vdmVUbyh4T2Zmc2V0LCB0ZXJtWFkuZ2V0V29yZC55ICsgMSk7XG4gICAgdGVybShcIihSRVRVUk4gdG8gZmluaXNoKVwiKTtcbiAgICAvLyBtb3ZlIGN1cnNvciB0byB3b3JkIGlucHV0IHBvc2l0aW9uXG4gICAgdGVybS5tb3ZlVG8odGVybVhZLmdldFdvcmQueCwgdGVybVhZLmdldFdvcmQueSk7XG4gICAgLy8gZXJhc2Ugd2hhdCB3YXMgdGhlcmVcbiAgICB0ZXJtKFwiICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiKTtcbiAgICBkZWJ1Z2dlcjtcbiAgICB0ZXJtLm1vdmVUbyh0ZXJtWFkuZ2V0V29yZC54LCB0ZXJtWFkuZ2V0V29yZC55KTtcbiAgICAvLyB0ZXJtKFwiSGVyZSBcIiArIHRlcm1YWS5nZXRXb3JkLnggKyBcIixcIiArIHRlcm1YWS5nZXRXb3JkLnkpO1xuICAgIC8vIHRlcm0ubW92ZVRvKHRlcm1YWS5nZXRXb3JkLngsIHRlcm1YWS5nZXRXb3JkLnkgKyA1KTtcbiAgICAvLyB0dXJuIG9mZiB0aGUga2V5IGV2ZW50IGxpc3RlbmVyIHVzaW5nIGdsb2JhbCB2YXJpYWJsZVxuICAgIHJlYWRXb3JkID0gdHJ1ZTtcbiAgICB0ZXJtLmlucHV0RmllbGQoe30sZnVuY3Rpb24gKGVycm9yOiBhbnksIGlucHV0OiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICBleGl0R2FtZSh0ZXJtLnJlZC5zdHIoXCJcXG5BbiBlcnJvciBvY2N1cnJlZCByZWFkaW5nIGlucHV0IGZpZWxkOiBcIiArIGVycm9yICsgXCJcXG5cIikpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYoIGlucHV0ID09PSB0aGVXb3JkLndvcmQyRnVsbFN0cmluZygpKSB7XG4gICAgICAgICAgICAgICAgLy8gZ3Vlc3NlZCByaWdodFxuICAgICAgICAgICAgICAgIHJlYWRXb3JkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgd29yZENvbXBsZXRlZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gZXJhc2UgdGhlIGluc3RydWN0aW9uc1xuICAgICAgICAgICAgICAgIHRlcm0ubW92ZVRvKHhPZmZzZXQsIHRlcm1YWS5nZXRXb3JkLnkpO1xuICAgICAgICAgICAgICAgIHRlcm0oXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiKTtcbiAgICAgICAgICAgICAgICB0ZXJtLm1vdmVUbyh4T2Zmc2V0LCB0ZXJtWFkuZ2V0V29yZC55ICsgMSk7XG4gICAgICAgICAgICAgICAgdGVybShcIiAgICAgICAgICAgICAgICAgICAgXCIpO1xuICAgICAgICAgICAgICAgIC8vIEJVRyBmaXgsIGVyYXNlIHRoZSB0eXBpbmcgYXQgdGhlIGtleSBpbnB1dCBsb2NhdGlvbnNcbiAgICAgICAgICAgICAgICB0ZXJtLm1vdmVUbyh0ZXJtWFkuaW5wdXQueCwgdGVybVhZLmlucHV0LnkpO1xuICAgICAgICAgICAgICAgIHRlcm0oXCIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiKTtcbiAgICAgICAgICAgICAgICAvLyBsZXQgdXNlciBrbm93IHdoYXQgaGFwcGVuZWRcbiAgICAgICAgICAgICAgICB0ZXJtLm1vdmVUbyh0ZXJtWFkuZ2V0V29yZC54LCB0ZXJtWFkuZ2V0V29yZC55KTtcbiAgICAgICAgICAgICAgICB0ZXJtKFwiR3Vlc3MgXFxcIlwiICsgaW5wdXQgKyBcIlxcXCIgd2FzIHdyb25nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiKTtcbiAgICAgICAgICAgICAgICAvLyBtb3ZlIGN1cnNvciBiYWNrIHRvIGlucHV0IHBvc2l0aW9uXG4gICAgICAgICAgICAgICAgdGVybS5tb3ZlVG8odGVybVhZLmlucHV0LngsIHRlcm1YWS5pbnB1dC55KTtcbiAgICAgICAgICAgICAgICAvLyBsZXQgdGhlIGV2ZW50IGxpc3RlbmVyIHdvcmsgYWdhaW5cbiAgICAgICAgICAgICAgICByZWFkV29yZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9ICAgICAgXG4gICAgfSk7XG59XG4vLyBmdW5jdGlvbiBjYWxsZWQgd2hlbiBhIGtleSBpcyBwcmVzc2VkIGluIHJhdyBtb2RlXG5mdW5jdGlvbiBwcm9jZXNzSW5wdXQoIGNoYXI6c3RyaW5nKTp2b2lkIHtcbiAgICBjb25zdCByZWdleHAgPSBuZXcgUmVnRXhwKFwiW2Etel1cIiwgXCJpXCIpO1xuICAgIGlmICggY2hhciA9PT0gXCJFTlRFUlwiKSB7XG4gICAgICAgIC8vIG1ha2UgYSBndWVzcyBhdCB0aGUgd29yZFxuICAgICAgICBndWVzc1dvcmQoKTtcbiAgICAgICAgaW5jR3Vlc3MoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoIChjaGFyLmxlbmd0aCA9PT0gMSkgJiYgKHJlZ2V4cC50ZXN0KGNoYXIpKSkge1xuICAgICAgICBjb25zdCBsY0NoYXIgPSBjaGFyLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIC8vIGNoZWNrIHRvIHNlZSB3aGV0aGVyIGxldHRlciBoYXMgYWxyZWFkeSBiZWVuIHNlbGVjdGVkXG4gICAgICAgIGlmIChfLmluZGV4T2YobGV0dGVyc0Nob3NlbixsY0NoYXIpID4gLTEpIHtcbiAgICAgICAgICAgIC8vIGRvbid0IHByb2Nlc3MgYW55dGhpbmcgYmVjYXVzZSBsZXR0ZXIgaGFzIGFscmVhZHkgYmVlbiBzZWxlY3RlZFxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaW5jR3Vlc3MoKTtcbiAgICAgICAgICAgIHRoZVdvcmQuY2hlY2tDaGFyKGxjQ2hhcik7XG4gICAgICAgICAgICBsZXR0ZXJzQ2hvc2VuLnB1c2gobGNDaGFyKTtcbiAgICAgICAgICAgIC8vIGNoZWNrIHRvIHNlZSBpZiB3b3JkIGlzIGNvbXBsZXRlZFxuICAgICAgICAgICAgaWYgKHRoZVdvcmQud29yZDJzdHJpbmcoKS5pbmNsdWRlcyhcIl9cIikpIHtcbiAgICAgICAgICAgICAgICAvLyBub3QgY29tcGxldGVkXG4gICAgICAgICAgICAgICAgc2hvd1dvcmQoKTtcbiAgICAgICAgICAgICAgICBzaG93TGV0dGVyc0Nob3NlbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc2hvd1dvcmQoKTtcbiAgICAgICAgICAgICAgICBzaG93TGV0dGVyc0Nob3NlbigpO1xuICAgICAgICAgICAgICAgIHdvcmRDb21wbGV0ZWQoKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICB9XG4gICAgfVxuICAgIC8vIGFueSBvdGhlciBrZXkgcHJlc3NlZCBkb2VzIG5vdGhpbmcgIFxufVxuXG5mdW5jdGlvbiB3b3JkQ29tcGxldGVkKCk6dm9pZCB7XG4gICAgLy8gZXJhc2UgZ3Vlc3NlZCB3b3JkXG4gICAgdGVybS5tb3ZlVG8odGVybVhZLmdldFdvcmQueCwgdGVybVhZLmdldFdvcmQueSk7XG4gICAgdGVybShcIiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiKTtcbiAgICB0ZXJtLm1vdmVUbyh0ZXJtWFkuY2hvb3NlQWdhaW4ueCwgdGVybVhZLmNob29zZUFnYWluLnkpO1xuICAgIHRlcm0oXCJjb21wbGV0ZWQgd29yZCBcXFwiXCIrIHRoZVdvcmQud29yZDJGdWxsU3RyaW5nKCkgKyBcIlxcXCJcIik7XG4gICAgdGVybShcIiBBbm90aGVyIGdhbWUgPyAoWS9uKVwiKTtcbiAgICByZWFkV29yZCA9IHRydWU7IC8vIG5vdCByZWFsbHkgcmVhZGluZyB3b3JkIGJ1dCBkaXNhYmxlcyBrZXkgZXZlbnRcbiAgICB0ZXJtLnllc09yTm8oeyB5ZXM6IFsneScsICdZJywnRU5URVInXSwgbm86IFsnbicsICdOJ10gfSwgZnVuY3Rpb24gKGVycm9yLCByZXN1bHQpIHtcbiAgICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICAgICAgcmVhZFdvcmQgPSBmYWxzZTsgLy8gcmUtZW5hYmxlZCBrZXkgZXZlbnRcbiAgICAgICAgICAgIHN0YXJ0KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBleGl0R2FtZSgpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgXG59XG5cbmZ1bmN0aW9uIHN0YXJ0KCk6dm9pZCB7ICBcbiAgICBjaG9vc2VXb3JkKCk7XG4gICAgbGV0dGVyc0Nob3NlbiA9IFtdO1xuICAgIGd1ZXNzZXMgPSAtMTsgLy8gcmVmZXJlbmNlZCB0aHJvdWdoIGluY0d1ZXNzZXMgZnVuY3Rpb24gd2hpY2ggYWx3YXlzIGluY3JlbWVudHMgc28gc3RhcnQgYXQgLTFcbiAgICBzZXR1cFRlcm1pbmFsKCk7XG4gICAgc2hvd1dvcmQoKTtcbiAgICBzaG93TGV0dGVyc0Nob3NlbigpO1xuICAgIGluY0d1ZXNzKCk7IC8vIGluY3JlbWVudHMgdG8gMCBhbmQgZGlzcGxheXMgbnVtYmVyIG9mIGd1ZXNzZXNcblxuICAgIC8vIGFmdGVyIHNldHVwLCBwcm9ncmFtIGlzIGRyaXZlbiBieSBrZXkgcHJlc3Nlc1xufVxuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gbWFpbiBwcm9ncmFtXG5zdGFydCgpO1xuXG4vLyBzZXQgdGVybWluYWwgdXAgdG8gcmVhZCBrZXkgcHJlc3Nlc1xudGVybS5ncmFiSW5wdXQodHJ1ZSk7XG5cbi8vIHNldCB3YXRjaGVyIG9uIGtleSBpbnB1dFxudGVybS5vbigna2V5JywgZnVuY3Rpb24gKG5hbWU6c3RyaW5nLCBtYXRjaGVzOmFueSwgZGF0YTphbnkpIHtcbiAgICBpZiAobmFtZSA9PT0gJ0NUUkxfQycpIHtcbiAgICAgICAgZXhpdEdhbWUoXCJDb250cm9sIEMgcHJlc3NlZCAtIGV4aXRpbmcgZ2FtZVwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiJ2tleScgZXZlbnQ6XCIgKyBuYW1lICsgXCIgbWF0Y2hlcyBcIiArIG1hdGNoZXMgKyBcIiBkYXRhIFwiICsgZGF0YSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoIXJlYWRXb3JkKSB7XG4gICAgICAgICAgICBwcm9jZXNzSW5wdXQobmFtZSk7XG4gICAgICAgIH0gXG4gICAgfVxufSk7XG5cblxuXG4iXX0=
